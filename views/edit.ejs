<% layout('layouts/boilerplate')%>

<style> 
  /* remove validation icons */
  .form-control.is-invalid, .was-validated .form-control:invalid  {
      background-image: none !important;
      border-color: #ced4da;
      padding-right: 0.75em;
      border-color: black !important;
  
  
  }
  
  .form-control.is-valid, .was-validated .form-control:valid  {
      background-image: none !important;
      border-color: #ced4da;
      padding-right: 0.75em;
      border-color: black !important;
  
  }
  
  .form-check-input {
    border-color: black !important;
  }
  
  .form-select:valid {
    border-color: black !important;
    --bs-form-select-bg-img: null; 
  }
  
  .was-validated .form-check-input:valid:checked {
    background-color: #0d6efd;
  }
  
  
  .form-check-input.is-valid:focus, .was-validated .form-check-input:valid:focus {
    box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb),.25);
  }
  </style>

<!-- need to write js that hides and erases the custom owner/holder window when self-owned is selected; same thing with for sale and price-->

<div class="row">
    <h1 class="text-center">Edit</h1>
    <div class="col-8 offset-2">

        <form class="row g-3 needs-validation" action="/collection/show/<%= p._id %>?_method=PUT" method="POST" enctype="multipart/form-data" novalidate >
  
<!-- Artist name -->
<div class="col-md-6">
    <label for="artist" class="form-label">Artist name:</label>
    <input type="text" class="form-control" id="artist" name="artist" placeholder="Author's name"  value="<%= p.artist %>" required>
    <div class="invalid-feedback">
        Entering a name is required!
    </div>
</div>
<div class="col-md-6"></div>

<!-- Title, Year -->
<div class="col-md-6">
    <label for="title" class="form-label">Title:</label>
    <input type="text" class="form-control" id="title" name="title" placeholder="What is the name of your piece?" value="<%= p.title %>" required>
    <div class="invalid-feedback">
        Entering a title is required!
    </div>
</div>
<div class="col-md-6">
    <label for="year_finished" class="form-label">Year Finished:</label>
    <input type="number" class="form-control" id="year_finished" name="year[0][year_finished]" placeholder="Year of origin" min="0" value="<%= p.year[0].year_finished %>">

</div>


<!-- to be unhidden with the checkbox above-->
<div class="col-md-5 " id="">
  <div   id="yearstarted" <% if (p.year[0].year_started == null) { %> class="collapse" <% } else { %> class="collapse show" <% } %> id="year_started" name="year[0][year_started]">
    <label for="year_started" class="form-label">Year Started:</label>
    <input type="number" class="form-control" placeholder="Year of origin" min="0" value="<%= p.year[0].year_started %>"> 
  </div>

</div>


<div class="col-md-2"> </div>

<!-- checkbox to unhide 'year started' attribute input -->
<div class="form-check col-md-5" >
  <input class="form-check-input" type="checkbox" value="" name="multiyear" id="multiyear" data-bs-toggle="collapse" data-bs-target="#yearstarted" <% if (p.year[0].year_started != null ) { %> checked="checked" <% } else %>>
  <label class="form-check-label" for="multiyear">
    Is it a multi-year work?
  </label>
</div>





<!-- Medium -->

<div class="col-md-6">
    <label for="medium" class="form-label">Medium:</label>
    <input type="text" class="form-control" id="medium" name="medium" placeholder="Is it oil on canvas?" value="<%= p.medium %>" required>
    <div class="invalid-feedback">
        Entering piece medium is required!
    </div>
</div>



<!-- Size -->

<label for="size-x" class="form-label">Size:</label>
        <div class="col-md-2" id="size-x"> 
            <input type="number" class="form-control" name="size[0][x]" placeholder="Width"  step=".01" min="0" value="<%= p.size[0].x %>">
        </div>
        <div class="col-md-2" id="size-y"> 
            <input type="number" class="form-control" name="size[0][y]" placeholder="Height"  step=".01" min="0" value="<%= p.size[0].y %>">
        </div>

        <!-- checkbox to unhide 'size-z' attribute input -->
        <!-- <div class="form-check col-md-2" >
          <input class="form-check-input" type="checkbox" id="is-3d" data-bs-toggle="collapse" data-bs-target="#size-z" <% if (p.size[0].z ==! null ) { %> checked="checked" <% } %>>
          <label class="form-check-label" for="is-3d">
            Add 'Depth' 
          </label>
        </div> -->

      <!-- to be uncollapsed with the checkbox above -->
        <div class="col-md-2 " id=""> 
          <div class ="" id="size-z">
            <input type="number" class="form-control " name="size[0][z]" placeholder="Depth"  step=".01" min="0" value="<%= p.size[0].z %>">
            </div>
        </div>


      <div class="col-md-1"></div>

<div class="col-md-2">
  <label class="form-check-label" for="unit">Size unit:</label>
  <select class="form-select" id="unit" aria-label="Small select example" name="size[0][unit]">
    <!-- <option selected >Unit</option> -->
    <option value="cm" <% if (p.size[0].unit === "cm") {  %> selected="selected" <% } %>>cm</option>
    <option value="in" <% if (p.size[0].unit === "in") {  %> selected="selected" <% } %>>in</option>
  </select>
</div>

<div class="col-md-1"></div>


<!-- For sale checkbox, Price --> 
<!-- later, hide and empty the price field using js if for sale == false -->

<label for="#for-sale-indent">For Sale:</label>

<div class="col-md-1" id="for-sale-indent"></div>
        <div class="form-check col-md-4">
    
          <input type="hidden" name="forSale" <% if (p.forSale == "1") { %> value="1" <% } else { %> value="0"  <% } %> ><input type="checkbox" class="form-check-input"  id="is_forsale" data-bs-toggle="collapse" data-bs-target=".price" onclick="this.previousElementSibling.value=1-this.previousElementSibling.value" <% if (p.forSale == "1") { %> checked="checked" <% } %> > 
          <label class="form-check-label" for="is_forsale">
            Is it, possibly, for sale?
          </label>
          
        </div>
        

<div class="col-md-4">
  <div  <% if (p.forSale == "1") { %> class="price collapse show" <% } else { %> class="price collapse" <% } %>  id="">
    <input type="number" class="form-control" id="" name="price[0][price]" placeholder="Price" min="0" <% if (p.price[0] != null) { %> value="<%= p.price[0].price %>" <% } %> >
  </div>
</div>

<div class=" col-md-2">
  <div <% if (p.forSale == "1") { %> class="price collapse show" <% } else { %> class="price collapse" <% } %> id="">
    <select class="form-select" aria-label="Small select example" name="price[0][currency]">
      <option value="PLN" <% if (p.price[0].currency == "PLN") { %> selected="selected" <% } %> >      PLN      </option>
      <option value="&#x20AC;" <% if (p.price[0].currency == "&#x20AC;") { %> selected="selected" <% } %>> &#x20AC; </option>
      <option value="&#36;" <% if (p.price[0].currency == "&#36;") { %> selected="selected" <% } %>> 	  &#36;    </option>
    </select>
</div>
</div>



<div class="col-md-12">    
  <div class="" id="description">
  <label for="description" class="form-label"> Description / Additional info: </label>
  <textarea type="text" class="form-control" id="" name="description" style="resize: none; height: 100px;"><%= p.description %></textarea>
    </div>
  </div>



<!-- Owner  -->   


<label for="owner-check" class="form-check-label">Owner:</label>
<div class="form-check col-md-4" id="owner-check">
  <label class="form-check-label" for="self-owned">
    I am the owner of this piece
  </label>
  <input class="form-check-input" type="radio" name="owner[0][status]" value="self" id="self-owned" 
  <% if (p.owner[0].name === '' || p.owner[0].name === undefined) { %> checked="checked" <% } %>  onchange="toggleCollapse('.owner-check')""
  onclick="clearFields('owner', 'owner_contact')"  >
</div>

<!-- if self-owned fill the data with user info  -->

<div class="form-check col-md-6">
  <label class="form-check-label" for="else-owned">
    Someone else is the owner of this piece
  </label>
  <input class="form-check-input" type="radio" name="owner[0][status]" value="else" id="else-owned"  onchange="toggleCollapse('.owner-check')" <% if (p.owner[0].name !== '' && p.owner[0].name !== undefined) { %> checked="checked" <% } %> >
</div>

    <!-- if someone else is the owner  -->

<div class="form-check col-md-5  ">
  <div class="">
    <input type="text" <% if (p.owner[0].name == '') { %> class="form-control collapse owner-check"<% } else { %> class="form-control owner-check" <% } %> name="owner[0][name]" id="owner" placeholder="Owner name" value="<%= p.owner[0].name %>" >
  </div>
</div>


<div class="form-check col-md-6 ">
  <div class=" ">
  <input type="text" <% if (p.owner[0].contact_info == '') { %> class="form-control collapse owner-check"<% } else { %> class="form-control owner-check" <% } %> name="owner[0][contact_info]" id="owner_contact" placeholder="Contact info"  value="<%= p.owner[0].contact_info %>">
  </div>
</div>

<div class="col-md-1"></div>


<!-- Is the piece currently held by someone that isn't the owner? If not so let holder = owner else{ -->

  <!-- Holder -->

  <label for="holder-check" class="form-check-label">Holder:</label>
  <div class="form-check col-md-4" name="holder-check">
    <label class="form-check-label" for="self-held">
      I am the holder of this piece
    </label>
  <input type="radio" class="form-check-input" name="holder[0][status]" value="self" id="self-held"  onchange="toggleCollapse('.holder-check')"
  <% if (p.holder[0].name === '' || p.holder[0].name === undefined) { %> checked="checked" <% } %>
  onclick="clearFields('holder', 'holder_contact')">
  </div>

  <!-- if self-owned fill the data with user info  -->


  <div class="form-check col-md-6">
    <label class="form-check-label" for="else-held">
      Someone else is the holder of this piece 
    </label>
    <input type="radio"  class="form-check-input" name="holder[0][status]" value="else" id="else-held"  onchange="toggleCollapse('.holder-check')" <% if (p.holder[0].name !== '' && p.holder[0].name !== undefined) { %> checked="checked" <% } %>>
  </div>



      <!-- If someone else is the holder  -->

  <div class="form-check col-md-5">
    <div class="holder-check ">
      <input type="text" <% if (p.holder[0].name == '') { %> class="form-control collapse holder-check"<% } else { %> class="form-control holder-check" <% } %>  name="holder[0][name]" id="holder" placeholder="Holder name" value="<%= p.holder[0].name %>" >
    </div>
  </div>

  <div class="form-check col-md-6">
    <div class="holder-check ">
      <input type="text" <% if (p.holder[0].contact_info == '') { %> class="form-control collapse holder-check"<% } else { %> class="form-control holder-check" <% } %>  name="holder[0][contact_info]" id="holder_contact" placeholder="Contact info" value="<%= p.holder[0].contact_info %>">
    </div>
  </div>

  <div class="col-md-1"></div>




<!-- Date of acquiration -->
  
  <label class="form-check-label" for="acquiration-date-field"> Acquiration Date: </label>
  <div class="col-md-5 form-check" name="acquiration-date-field"id="acquiration-date-field">
    <input type="date" class="form-control" name="acquiration_date" value="<%=  moment(p.acquiration_date).format("YYYY-MM-DD") %>" />
</div>

<div class="col-md-7">

</div>


<!-- Catalogue number -->
<label class="form-check-label" for="catalogue-number-indent">Catalogue Number:</label>
<div class="col-md-1" id="catalogue-number-indent"></div>

  <div class="col-md-6">
    <div id="catalogue" class="">
      <input type="text" class="form-control"  name="catalogue" placeholder="Catalogue number" value="<%= p.catalogue  %>">
    </div>
  </div> 




<div class="col-md-7"></div>
<!-- Archival checkbox -->

<div class="form-check col-md-5">
    <input type="hidden" name="archival" <% if (p.archival.value == "1") { %> value="1" <% } else { %> value="0" <% } %> ><input type="checkbox" class="form-check-input" id="archival-check" onclick="this.previousElementSibling.value=1-this.previousElementSibling.value" <% if (p.archival == "1") { %> checked="checked" <% } else{} %>  >
    <label class="form-check-label" for="archival-check">
      Mark this release as archival
  </label>
</div>



<div class="col-md-6">
    <button class="btn btn-primary mb-2 ">Update piece</button>
    </div>
    
  </form>

  <div class="col-md-6">

<form action="/collection/show/<%=p._id%>?_method=DELETE" method="POST" >
        <button class="btn btn-danger mb-5" onclick="return confirm('Are you sure you want to delete this piece? There will be no coming back!')">Delete piece</button>
</form>

<a class="btn btn-warning mb-5" href="/collection/show/<%=p._id%>/edit/images">Edit images</a>

</div>
</div>



<script> 

// bootstrap validations
(function () {
'use strict'

var forms = document.querySelectorAll('.needs-validation')

// Loop over them and prevent submission
Array.prototype.slice.call(forms)
    .forEach(function (form) {
    form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
        }

        form.classList.add('was-validated')
    }, false)
    })
})()




function clearFields(fi1, fi2) {
  document.getElementById(fi1).value = ""
  document.getElementById(fi2).value = ""
};


const toggleCollapse = (inputClass) => {
  for (el of document.querySelectorAll(inputClass)) 
  { if (!el.classList.contains('show')) {
    el.classList.add('show') } else {
      el.classList.remove('show')
    }}}


</script>


